<!DOCTYPE html>
<html lang="en" style="height:100%;">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>数据资产</title>
    <!-- Bootstrap core CSS -->
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="lib/jquery-3.2.1.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.min.js"></script>
    <script src="lib/echarts.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="lib/bootstrap-table/bootstrap-table.min.css">

    <link href="css/table.css" rel="stylesheet">
    <!-- Latest compiled and minified JavaScript -->
    <script src="lib/bootstrap-table/bootstrap-table.min.js"></script>

    <!-- Latest compiled and minified Locales -->
    <script src="lib/bootstrap-table/bootstrap-table-zh-CN.min.js"></script>

    <style>
        a {
            color: #ccc;
            cursor: pointer;
        }

        a:hover, a:focus {
            color: #5792E5;
        }
        /*
         * Global add-ons
         */

        .sub-header {
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        /*
         * Top navigation
         * Hide default border to remove 1px line.
         */
        .navbar-fixed-top {
            border: 0;
        }

        /*
         * Sidebar
         */

        /* Hide for mobile, show later */
        .sidebar {
            display: none;
        }

        @media (min-width: 768px) {
            .sidebar {
                position: fixed;
                top: 51px;
                bottom: 0;
                left: 0;
                z-index: 1000;
                display: block;
                padding: 20px;
                overflow-x: hidden;
                overflow-y: auto; /* Scrollable contents if viewport is shorter than content. */
                background-color: #f5f5f5;
                border-right: 1px solid #eee;
            }
        }

        /*
         * Main content
         */

        .main {
            padding: 20px;
        }

        @media (min-width: 768px) {
            .main {
                padding-right: 40px;
                padding-left: 40px;
            }
        }

        .main .page-header {
            margin-top: 0;
        }

        /*
         * Placeholder dashboard ideas
         */

        .placeholders {
            margin-bottom: 30px;
            text-align: center;
        }

        .placeholders h4 {
            margin-bottom: 0;
        }

        .placeholder {
            margin-bottom: 20px;
        }

        .placeholder img {
            display: inline-block;
            border-radius: 50%;
        }

        .jumbotron {
            text-align: left;
            padding: 20px;
        }

        .jumbotron p {
            font-size: inherit;
        }

        .big-character {
            margin-right: 40px;
            font-size: 24px;
            color: #53ad7d;
        }

        .chart-box {
            height: 500px;
            background-color: #eef3f7;
        }

        .btn-close {
            font-size: 16px;
            color: #286090;
        }

        .detail-panel {
            margin-left: -40px;
            margin-top: -40px;
            text-align: center;
            position: absolute;
            top: 103px;
            background: white;
            width: 88%;
            min-width: 800px;
            padding: 40px;
            display: none;
        }

        .detail-main-page {
            display: none;
        }

        .detail-waiting-page {
            height: 400px;
        }

        .detail-external-page {
            display: none;
        }

        .detail-external-page.active {
            display: block;
        }

        .terminal-box {
            width: 100%;
            background: #3f3f3f;
            color: white;
            font-family: Courier New;
        }

        .host-detail {
            cursor: pointer;
        }

        .breadcrumb-nav {
            height: 75px;
            padding: 20px 40px 20px 40px;
            background-color: #262D37;;
            box-shadow: 0 1px 3px #ddd;
        }

        .breadcrumb-nav .breadcrumb-svg {
            height: 30px;
            width: 30px;
            vertical-align: top;
            margin-right: 10px;
        }

        .breadcrumb-nav .breadcrumb-span {
            font-size: 24px;
            color: #FFFFFF;
        }
        #detail_table thead{
            height: 44px;
            background-color: #2d3543;
            font-weight: normal;
            font-size: 12px;

        }
        #detail_table>thead>tr>th {
            /*padding-left: 15px;*/
            border-bottom: 2px solid #5792E5;
        }
        #detail_table>tbody>tr>td{
            padding: 0;
        }
        #detail_table>tbody>tr:hover{
            color:#5792E5;
        }
        #detail_table>tbody>tr>td{
            height: 40px;
            line-height: 40px;
            /*padding-left: 15px;*/
            background: #1C2331;
            font-weight: normal;
            font-size: 12px;
            border-bottom: 1px solid #32507A;
        }
        #detail_table .glyphicon{
            color: #4A90E2;
            padding-left: 3px;
        }
        #appDetailModal .modal-content{
            background-color: #1C2331;
            color: #fff;
        }
        /*.standard  {
            border: none;
        }*/
        #interfaceDetailTable {
            border: 1px solid #32507A;
            margin: auto;
        }
        #interfaceDetailTable>tbody>tr>td {
            padding: 8px;
            font-weight: normal;
            font-size: 13px;
            border: 1px solid #32507A;
        }
        #interfaceDetailTable>tbody>tr>td:first-child {
            background-color: #29344A
        }
        .standard-detail .pull-right.pagination ul.pagination>li>a {
            background-color: #1C2331;
            border-color: #32507A;
            color: #fff;
        }
    </style>

</head>

<body style="height:100%;">

<div class="left-nav-wrap">
    <script>
        $('.left-nav-wrap').load('leftNav-black.html');
    </script>
</div>
<div class="top-wrap">
    <script>
        $('.top-wrap').load('fix-top-black.html');
    </script>
</div>
<div class="breadcrumb-nav" style="margin-left:200px;">
    <img src="image/svg/localMirror.svg" class="breadcrumb-svg" alt=""/>
    <span class="breadcrumb-span">数据资产</span>
</div>
<div style="padding: 20px 20px 20px 20px;margin-left:200px;height:auto;min-height: 100%;background-color: #12141B">
    <div style="width: 100%;height: auto; min-height: calc(100% - 30px);background-color: #1C2331;border: 1px solid #3D5B77">
        <div style="width: 100%;height: 250px;padding: 12px;">
            <div style="display: inline-block;width: 30%;height:100%;">
                <div style="border-bottom: 1px solid #3D5B77;font-size: 13px;color: #999;margin-top: 5px;padding-left: 5px;">
                    资产总数
                </div>
                <div id="chart3" style="width: 100%;height:100%;display: inline-block;padding-top: 10px"></div>
            </div>
            <div style="vertical-align:top;display: inline-block;width: 69%;height:100%;margin-top: 5px;">
                <div style="border-bottom: 1px solid #3D5B77;font-size: 13px;color: #999;padding-left:5px;">
                    资产更新频率
                </div>
                <div id="chart4" style="width: 100%;height:85%;display: inline-block;"></div>
            </div>
        </div>
        <div id="detail" style="vertical-align:top;width: 100%;height:49%;padding: 20px;">
            <div style="height: 100%">
                <!--<div style="border-bottom: 1px solid #3D5B77;font-size: 13px;color: #999;margin-top: 5px;padding-left:5px;">
                    资料详情
                </div>-->
                <div class="ability-top" style="width: 100%">
        <div style="font-size: 13px;color: #44C0FF;display: inline-block;">资料详情:</div>
        <div class="detail-type" style="display: inline-block;width:calc(100% - 100px);border-bottom: 1px solid #3D5B77">
            <div class="btn-group btn-group-xs" role="group" aria-label="...">
                <button type="button" class="btn" onclick="initDetailTable('B域')"
                        style="padding:3px 10px 0 8px;border-radius: 5px 5px 0 0;font-size:10px;margin-right:1px;background-color: #5EA3F8;color: white">
                    B域
                </button>
                <button type="button" class="btn" onclick="initDetailTable('O域')"
                        style="padding:3px 10px 0 8px;border-radius: 5px 5px 0 0;font-size:10px;margin-right:1px;background-color: #3D5B77;color: white">
                    O域
                </button>
                <button type="button" class="btn" onclick="initDetailTable('M域')"
                        style="padding:3px 10px 0 8px;border-radius: 5px 5px 0 0;font-size:10px;margin-right:1px;background-color: #3D5B77;color: white">
                    M域
                </button>
            </div>
        </div>

                <div class="standard standard-detail" style="height: 100%;padding-top: 10px;">
                    <table id="detail_table"></table>
                </div>
            </div>
          <!--  <div style="display: inline-block;width: 50%;height:100%;">
                <div style="border-bottom: 1px solid #3D5B77;font-size: 13px;color: #999;margin-top: 5px;padding-left:5px;">
                    接口数
                </div>
                <div id="chart5" style="width: 100%;height:90%;display: inline-block;"></div>
            </div>

            <div style="display: inline-block;width: 48%;height:100%;">
                <div style="border-bottom: 1px solid #3D5B77;font-size: 13px;color: #999;margin-top: 5px;padding-left:5px;">
                    数据源
                </div>
                <div id="chart6" style="width: 100%;height:90%;display: inline-block;"></div>
            </div>-->
        </div>
    </div>

</div>
<script src="util/chart.js"></script>
<script type="text/javascript">
//    var baseUrl = "http://10.132.49.137:3031/api/v1/";
//    var bareadata = baseUrl + "b-area-interface",
//            oareadata = baseUrl + 'o-area-interface',
//            mareadata = baseUrl + 'm-area-interface';
        var bareadata = 'data/b_area_interface.json';
        var oareadata = 'data/o_area_interface.json';
        var mareadata = 'data/m_area_interface.json';
    //表3
    var myChart3 = echarts.init(document.getElementById('chart3'));
    var option3 = {
      title: {
        text: '472',
        left: '39%',
        bottom: 'center',
        textStyle: {
          color: '#ccc',
          fontSize: 24
        }
      },
      tooltip: {
        trigger: 'item',
        formatter: function (obj) {
          return obj.seriesName + '<br/>' + obj.name + ": "  + obj.percent + '%';
        }
      },
      // 图例
      legend: {
        data: ["B域", "O域", 'M域'],
        textStyle: {
          color: '#ccc'
        },
//          orient : 'vertical',
          right:0
//          bottom: '10%',
//          right: 0
      },
      // 数据内容数组
      series: [
        {
          name: '资产总数',
          type: 'pie',
          center: ['45%', '50%'],
          radius: ['42%', '54%'],
          avoidLabelOverlap: true,
          label: {
            normal: {
              show: true
            },
            emphasis: {
              show: true
            }
          },
          data: [
            {value: 199, name: 'B域'},
            {value: 70, name: 'O域'},
            {value: 203, name: 'M域'}
          ],
          itemStyle: {
            normal: {
              label: {
                show: true,
                formatter: '{c}'
              },
              labelLine: {show: true}
            }
          }
        }
      ],
      color: ['#ECBE65', '#49B8F2', '#A08BCD']
    };
    myChart3.setOption(option3);
    myChart3.on('click', function (param) {
        $("#detail").css("display", "block");
        initDetailTable(param.name);
    });

    ////////////////////////////////////////////
    //表4
    options = buildBlackBarOptions(['实时', '小时', '日', '月'], {
        type: 'value',
//        min: 0,
//        max: 80,
//        interval: 20,
        axisLabel: {
            formatter: '{value}'
        },
        axisLine: {
            lineStyle: {
                color: '#2d3f64'
            }
        },
        axisTick: {
            show: false
        },
        splitLine: {
            lineStyle: {
                color: '#2d3f64',
                type: 'dotted'
            }
        }
    }, [
    {name: 'B域', data: [0, 10, 129, 60], barWidth: 18},
    {name: 'O域', data: [0, 150, 53, 0], barWidth: 18},
        {name: 'M域', data: [2, 23, 45, 0], barWidth: 18}
  ]);
  drawChart(document.getElementById('chart4'), options);
    function openAppModal(row) {
        var $modal = $("#appDetailModal");
        $modal.modal('show');
        var id = row.ods_code;
        $modal.find(".modal-title").text(row.ods_interface_zn);
        $modal.find("tr.interface>td:nth-child(2)").html(row.ods_interface_en);
        $modal.find("tr.interface-zn>td:nth-child(2)").html(row.ods_interface_zn);
//        $modal.find("tr.period>td:nth-child(2)").html(row.period);
        $modal.find("tr.ods>td:nth-child(2)").html(row.ods_code);
        $modal.find("tr.extra>td:nth-child(2)").html('实时');
        $modal.find("tr.extra-time>td:nth-child(2)").html('实时');
        $modal.find("tr.save-time>td:nth-child(2)").html('7天');
        $modal.find("tr.application>td:nth-child(2)").html('数据天网城市公共安全解决方案<br/>贵州旅游大数据应用<br/>贵州交警大数据应用');
        if(id==16305) {
            $modal.find("tr.responser>td:nth-child(2)").html('负责人：逯明，张伟东 ；确认人：史凯');
            $modal.find("tr.datasource>td:nth-child(2)").html('DPI信令采集系统');
        } else if (id == 16099) {
            $modal.find("tr.responser>td:nth-child(2)").html('负责人：逯明，张伟东 ；确认人：聂辉');
            $modal.find("tr.datasource>td:nth-child(2)").html('CS信令监测系统');
        }
    }
    function initDetailTable(type) {
        $(".detail-type").find("button").each(function () {
           var text = $(this).text().trim();
            if(text == type) {
                $(this).css('background-color', '#5EA3F8');
            } else {
                $(this).css('background-color', '#3D5B77');
            }
        });
        var url = '';
        var columns = [{
            field: 'ods_code',
            title: '资产编码',
            align: 'center',

            formatter: function(cell) {
                return '<a href="javascript:void(0)">'+cell+'<i class="glyphicon glyphicon-tags"></i></a>';
            },
            events: {
                'click a': function(event, value, row, index) {
                    if(value==16305 || value == 16099) {
                        openAppModal(row);
                    }
                }
            }
        }, {
            field: 'ods_interface_zn',
            title: '中文名称',
            align: 'center',
            formatter: function(cell, row) {
                return cell
            },
            events: {
                'click a': function(event, value, row, index) {
                    var id = row.ods_code;
                    if(id==16305 || id == 16099) {
                        openAppModal(row);
                    }
                }
            }
        }, {
            field: 'ods_interface_en',
            title: '英文名称',
            align: 'center'
        }, {
            field: 'theme',
            title: '主题域',
            align: 'center'
        }, {
            field: 'theme_son',
            title: '主题子域',
            align: 'center'
        }, {
            field: 'period',
            title: '取数周期',
            align: 'center'
        }];
        if(type=="B域") {
            url = bareadata;
            columns = columns.concat([{
                field: 'priority',
                title: '当前状态',
                align: 'center',
                formatter: function(cell) {
                    return statusFormatter(cell=="下线处理"?cell:"已接入");
                }
            }]);
        } else if (type == "O域") {
            url = oareadata;
            columns = columns.concat([{
                field: 'content',
                title: '当前状态',
                align: 'center',
                formatter: statusFormatter
            }]);
        } else if (type == "M域") {
            url = mareadata;
            columns.splice(2, 1, {
                field: 'table_name',
                title: '英文名称',
                align: 'center',
            });
            columns = columns.concat([{
                field: 'content',
                title: '当前状态',
                align: 'center',
                formatter: statusFormatter
            }]);
        }
        $("#detail_table").bootstrapTable('destroy').bootstrapTable({
        method: 'get',
        url: url,
        cache: false,
//        striped: true,
        pagination: true,
        pageSize: 12,
        pageList: [5, 10, 15, 20],
        columns: columns,
            responseHandler: function(res) {
                var rows = [];
                if(type == "B域") {
                    rows = res.b_area_interface;
                } else if (type == "O域") {
                    rows = res.o_area_interface;
                } else if (type == "M域") {
                    rows = res.m_area_interface;
                }
                return rows;
//                return { rows: rows, total: rows.length}
            }
//            data: [{id: 1}, {id: 2}, {id: 3}, {id: 4}, {id: 5}, {id: 6}, {id: 7}, {id: 8}, {id: 9}, {id: 10}, {id: 11}]
    });
        function statusFormatter(cell) {
            var bgcolor = '';
                    if(cell=="下线处理"){
                        bgcolor = 'btn-danger';
                    } else if (cell=="已接入") {
                        bgcolor = 'btn-primary';
                    } else if (cell=="未接入") {
                        bgcolor = 'btn-warning';
                    }
                    return '<button type="button" class="btn btn-xs '+bgcolor+'">'+cell+'</button>'
        }
    }
    initDetailTable("B域");
</script>
    <!-- 模态框（Modal） -->
    <div class="modal fade" id="appDetailModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" >
                <div class="modal-header" style="border-bottom: 1px solid #5792E5 !important;">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true" style="color: #fff">&times;</span></button>
                    <h4 class="modal-title">Modal table</h4>
                </div>
                <div class="modal-body">
                    <table id="interfaceDetailTable">
                        <tbody style="text-align: left">
                            <tr class="interface"><td style="width: 20%"资产名称</td><td>vv</td></tr>
                            <tr class="ods"><td style="width: 20%">资产编码</td><td>daf</td></tr>
                            <tr class="interface-zn"><td style="width: 20%">资产说明</td><td>vv</td></tr>
                            <tr class="responser"><td style="width: 20%">资产责任人</td><td>dd</td></tr>
                            <tr class="datasource"><td style="width: 20%">数据源系统</td><td>dd</td></tr>
                            <tr class="extra"><td style="width: 20%">抽取方式及周期</td><td>dd</td></tr>
                            <tr class="extra-time"><td style="width: 20%">抽取时间</td><td>dd</td></tr>
                            <tr class="save-time"><td style="width: 20%">保存周期</td><td>dd</td></tr>
                            <tr class="application"><td style="width: 20%; background-color: #213E78">所接应用</td><td>dd</td></tr>
                        </tbody>
                        <!--<thead>
                        <tr>
                            <th data-field="id">ID</th>
                            <th data-field="name">Item Name</th>
                            <th data-field="price">Item Price</th>
                        </tr>
                        </thead>-->
                    </table>
                </div>
                <div class="modal-footer" style="border-color: #5792E5 !important;">
                    <button type="button"
                            class="btn btn-info btn-sm"
                            style="background-color: #4A90E2"
                            data-dismiss="modal">关闭</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</body>
</html>
